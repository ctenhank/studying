# LXC

리눅스 커널의 기술적 한계

기존 하이퍼바이저 기반 기술: **KVM, Xen**

> 하이퍼바이저 기술의 오버헤드:



### 리눅스 커널의 기술적 한계를 극복

- 네임스페이스
- cgroup



## 운영체제 커널의 발전과 초기 운영체제 커널의 제한사항

#### CPU 측면

1. 오직 하나의 프로세스만 CPU를 예약하고 사용

   > ***한계***
   > 입출력 시 완료될 때까지 CPU 자원 낭비

2. CPU 스케쥴러 등장과 함께, 더 많은 프로세스에 공정하게 할당함으로써 CPU 사용률 극대화

   > 현재 리눅스는 CFS(Completely Fair Scheduler)라는 CPU 스케쥴러 이용
   >
   > ***한계***
   > 실제 운영 환경에서는 프로세스와 또는 그 하위 프로세스에게 별도의 우선순위 부여가 필요한 경우가 발생
   > 보통 이러한 경우 `nice()` 시스템 콜이나 실시간 스케줄링 정책을 활용해 우선순위를 변경하지만
   > *변경 가능한 세분화 수준과 통제에는 한계가 존재* (이것에 대한 정확한 이해가 필요)

#### Memory 측면

1. 여러 개의 프로세스가 실제로 존재하는 물리 메모리의 공유 풀로부터 사용할 메모리를 할당

   > ***한계***
   > 여러 개의 프로세스는 시스템에 물리적으로 존재하는 것보다 더 많은 양의 메모리를 요구

2. 가상 메모리 기법을 통해 메모리 자원 활용을 위해 서로 경쟁하는 프로세스 간에 메모리를 공유하게 하여, 
   시스템이 실제로 보유한 것보다 더 많은 메모리를 가진 것처럼 보이게 함

   > 가상 메모리는 프로세스마다 각자의 독립된 가상의 주소 공간을 가지고 ***메모리 스왑*** 을 통해 사용 가능한 메모리를 확장하는 방식을 사용
   > 이들 가상 주소 공간은 서로 완벽하게 분리돼 특정 애플리케이션을 실행하는 다른 프로세스에 영향을 줄 수 없도록 메모리를 격리하는 형태를 제공했지만,
   > *가상 메모리 역시 각각의 프로세스와 자식 프로세스가 사용하는 메모리의 양을 효율적으로 제한하지는 못함* (이것에 대한 정확한 이해가 필요)
   >
   > **메모리 스왑**
   >
   > - 프로세스는 가상 페이지를 물리적 메모리에서 가져오기 때문에, 비어있는 물리적 페이지가 없다면 물리적 메모리에서 다른 페이지를 제거해 공간을 마련
   > - 물리적 메모리에서 페이지가 제거될 때:
   >   - 페이지 변경이 없었다면 페이지의 내용을 저장하지 않고 그냥 제거
   >   - 페이지 변경됐다면, 운영체제는 페이지의 변경된 내용을 보존
   >     이런 변경이 이뤄진 페이지를 *더티 페이지* 라고 하며, 메모리에서 제거할 때 스왑 파일이라는 특별한 파일에 변경 내용을 저장 
   >     스왑 파일은 프로세서나 물리적 메모리의 속도에 비해 매우 느리므로, 빈번한 메모리 스왑이 발생하지 않도록 잘 다뤄야 함

#### System 측면

- 각기 다른 애플리케이션을 하나의 물리 서버에서 운영할 경우 특정 애플리케이션에서 발생하는 메모리 누수나 커널 패닉 현상이 운영체제를 다운시킬 수 있음

  > 즉 메모리 문제는 하나의 서버에서 실행 중인 전체 서비스에 부정적인 영향을 미칠 수 있음 
  >
  > 한 예로, 
  > 메모리 작업이 많은 웹 서버와 I/O 작업이 많은 데이터베이스 서비스가 하나의 물리 서버에서 운영되면
  > 일반적으로 시스템 자원 관련 문제가 발생할 가능성이  높다

- 위와 같은 상황을 피하기 위해서 시스템 관리자는 서버 풀 안에서 애플리케이션을 분리하고, 자원 요구량이 최대인 시점을 기준으로 서버 자원을 산정해 시스템을 운영

  > 작업이 많지 않은 시간대에는 몇몇 시스템은 낮은 사용률을 유지

위와 같은 문제를 해결하기 위해 **하이퍼바이저 기반 가상화**나 **컨테이너 기반 가상화** 기술을 사용



## 가상화 기술

#### 하이퍼바이저 기반 가상화

- 1960년대 후반 메인프레임 초기 시절부터 사용됨
- 호스트 컴퓨터에서 다수의 운영체제를 동시에 실행하기 위한 논리적 플랫폼이며, 가상 머신의 라이프 사이클 관리를 담당하는 가상화 기술
- 대표적인 오픈소스 하이퍼바이저: **Xen**, **KVM**

#### 컨테이너 기반 가상화

- namespaces
- cgroups
- copy-on-write storage
- chroot
- cgroups



## 리눅스 네임스페이스













